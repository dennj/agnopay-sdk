# AgnoPay SDK - Package Summary

## What We Built

A production-ready npm package for the AgnoPay SDK that can be distributed via npm and used across different frameworks.

## Package Structure

```
agnopay-sdk/
â”œâ”€â”€ src/                          # TypeScript source files
â”‚   â”œâ”€â”€ index.ts                  # Main exports
â”‚   â”œâ”€â”€ config.ts                 # Configuration system
â”‚   â”œâ”€â”€ client.ts                 # Core API client
â”‚   â”œâ”€â”€ client-hooks.ts           # React hooks
â”‚   â”œâ”€â”€ server.ts                 # Next.js server utilities
â”‚   â”œâ”€â”€ types.ts                  # TypeScript types
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ AgnoPayCheckout.tsx      # React checkout component
â”œâ”€â”€ dist/                         # Compiled output (generated by build)
â”œâ”€â”€ package.json                  # npm package configuration
â”œâ”€â”€ tsconfig.json                 # TypeScript configuration
â”œâ”€â”€ tsup.config.ts                # Build configuration
â”œâ”€â”€ .npmignore                    # Files to exclude from npm
â”œâ”€â”€ LICENSE                       # MIT License
â”œâ”€â”€ CHANGELOG.md                  # Version history
â””â”€â”€ README.md                     # Package documentation

## Key Features

### 1. Configurable URLs
- API URL and Wallet URL are now configurable
- Can be set globally via `configureAgnoPay()` function
- Can be overridden per-hook or per-component
- Default values:
  - API: `https://agnoapi.vercel.app`
  - Wallet: `http://localhost:3000`

### 2. Build System (tsup)
- Compiles TypeScript to JavaScript
- Generates `.d.ts` type declaration files
- Outputs multiple formats:
  - ESM (`.mjs`) - Modern bundlers
  - CommonJS (`.js`) - Node.js
- Creates source maps for debugging
- Automatically adds 'use client' directive to React files

### 3. Module Exports
Configured with conditional exports for optimal loading:
- `@agnopay/sdk` - Main entry (all exports)
- `@agnopay/sdk/client` - Core client only
- `@agnopay/sdk/hooks` - React hooks only
- `@agnopay/sdk/components` - React components only
- `@agnopay/sdk/server` - Next.js server utilities
- `@agnopay/sdk/types` - TypeScript types only

### 4. Peer Dependencies
- React and React-DOM are optional peer dependencies
- Users who don't use React won't have it in their bundles
- Supports React 16.8+ through React 19+

### 5. Tree-Shaking
- `sideEffects: false` enables aggressive tree-shaking
- Users only bundle what they import
- Example: Importing only `AgnoPaySDK` client won't bundle React

## Installation & Usage

### Install from npm
```bash
npm install @agnopay/sdk
```

### Basic Usage
```typescript
import { useAgnoPayCheckout, AgnoPayCheckout, configureAgnoPay } from '@agnopay/sdk';

// Optional: Configure custom URLs
configureAgnoPay({
  apiUrl: 'https://api.production.com',
  walletUrl: 'https://wallet.production.com'
});

// Use in components
const { createOrder, isLoading } = useAgnoPayCheckout({
  publishableKey: 'ak_...',
  onSuccess: (order) => console.log(order.id)
});

<AgnoPayCheckout orderId={order.id} />
```

## Build Process

### Development
```bash
cd agnopay-sdk
npm install
npm run build          # Build once
npm run build:watch    # Watch mode
npm run type-check     # Check types without emit
```

### Publishing to npm

#### One-time setup
```bash
npm login
```

#### Per-release workflow
```bash
# 1. Update version
npm version patch  # or minor, or major

# 2. Update CHANGELOG.md with changes

# 3. Build and publish
npm publish --access public

# 4. Create git tag
git tag v0.1.0
git push origin v0.1.0
```

## Architecture Decisions

### âœ… Why Framework-Agnostic Core?
- The `AgnoPayClient` has zero React dependencies
- Can be used in vanilla JS, Vue, Svelte, etc.
- React hooks and components are optional add-ons

### âœ… Why Configurable URLs?
- Development vs Production environments
- Self-hosted instances
- White-label solutions
- Testing with different backends

### âœ… Why Separate Build Configs?
- React files get 'use client' directive
- Core files don't (can be used server-side)
- Optimal for Next.js and other RSC frameworks

### âœ… Why Optional Peer Dependencies?
- Smaller bundles for non-React users
- Version flexibility
- No duplicate React in bundles

## Migration from Local SDK

The merchant app currently uses the SDK from `lib/agnopay-sdk/`. After publishing to npm:

### Before (Local)
```typescript
import { useAgnoPayCheckout } from '@/lib/agnopay-sdk';
```

### After (npm package)
```typescript
import { useAgnoPayCheckout } from '@agnopay/sdk';
```

Then update `package.json`:
```json
{
  "dependencies": {
    "@agnopay/sdk": "^0.1.0"
  }
}
```

## Next Steps

1. **Test the build**:
   ```bash
   cd /Users/dennj/workspace/agnopay-sdk
   npm install
   npm run build
   ```

2. **Verify output**:
   - Check `dist/` folder has all compiled files
   - Verify `.d.ts` files are generated
   - Test imports work correctly

3. **Test locally before publishing**:
   ```bash
   # In SDK package
   npm link

   # In merchant app
   npm link @agnopay/sdk
   ```

4. **Publish to npm**:
   ```bash
   npm publish --access public
   ```

5. **Update merchant app**:
   - Install from npm: `npm install @agnopay/sdk`
   - Update imports
   - Remove local `lib/agnopay-sdk` folder

## Package Size Estimate

- Core client + types: ~5KB (gzipped)
- React hooks: ~3KB (gzipped)
- React component: ~4KB (gzipped)
- **Total: ~12KB (gzipped)**

Very lightweight! ðŸŽ‰
